$id: https://schemas.meshery.io/relationship.yaml
$schema: http://json-schema.org/draft-07/schema#
description: Relationships define the nature of interaction between interconnected components in Meshery. The combination of relationship properties kind, type, and subtype characterize various genealogical relations among and between components. Relationships have selectors, selector sets, metadata, and optional parameters. Learn more at https://docs.meshery.io/concepts/logical/relationships.
required:
  - schemaVersion
  - version
  - model
  - kind
  - type
  - subType
additionalProperties: false
type: object
definitions:
  SelectorPair:
    type: object
    description: Optional selectors used to match Components. Absence of a selector means that it is applied to all Components.
    additionalProperties: false
    required:
      - allow
    properties:
      deny:
        description: Optional selectors used to define relationships which should not be created / is restricted.
        type: object
        required:
          - to
          - from
        properties:
          from:
            $ref: ./selector.yaml#/definitions/selector
          to:
            $ref: ./selector.yaml#/definitions/selector
      allow:
        description: Selectors used to define relationships which are allowed.
        type: object
        required:
          - to
          - from
        properties:
          from:
            $ref: ./selector.yaml#/definitions/selector
          to:
            $ref: ./selector.yaml#/definitions/selector
properties:
  id:
    description: Uniquely identifies the entity (i.e. component) as defined in a declaration (i.e. design).
    type: string
    format: uuid
    x-go-type: uuid.UUID
    x-go-type-import:
      path: github.com/gofrs/uuid
    x-oapi-codegen-extra-tags:
      yaml: id
      json: id
  schemaVersion:
    description: Specifies the version of the schema used for the relationship definition.
    type: string
    minLength: 2
    maxLength: 100
    pattern: ([a-z.])*(?!^/)v(alpha|beta|[0-9]+)([.-]*[a-z0-9]+)*$
    example:
      - v1
      - v1alpha1
      - v2beta3
      - v1.custom-suffix
    x-oapi-codegen-extra-tags:
      yaml: schemaVersion
      json: schemaVersion
    default: relationships.meshery.io/v1alpha3
  version:
    description: Specifies the version of the relationship definition.
    type: string
    minLength: 5
    maxLength: 100
    $ref: ../v1alpha1/core/api.yml#/components/schemas/semverString
    x-oapi-codegen-extra-tags:
      yaml: version
      json: version
  model:
    $ref: ../v1beta1/model/api.yml#/components/schemas/ModelReference
    x-go-type: model.ModelReference
    x-go-type-import:
      path: github.com/meshery/schemas/models/v1beta1/model
    x-order: 8
    description: Reference to the specific registered model to which the component belongs and from which model version, category, and other properties may be referenced. Learn more at https://docs.meshery.io/concepts/models
  kind:
    description: Kind of the Relationship. Learn more about relationships - https://docs.meshery.io/concepts/logical/relationships.
    enum:
      - hierarchical
      - edge
      - sibling
    type: string
    pattern: ^[a-zA-Z_][a-zA-Z0-9_-]*[a-zA-Z0-9_]$
    x-oapi-codegen-extra-tags:
      yaml: kind
      json: kind
  type:
    description: Classification of relationships. Used to group relationships similar in nature.
    x-go-name: RelationshipType
    gorm: column:type
    type: string
    pattern: ^[a-zA-Z_][a-zA-Z0-9_-]*[a-zA-Z0-9_]$
    x-oapi-codegen-extra-tags:
      yaml: type
      json: type
  subType:
    description: Most granular unit of relationship classification. The combination of Kind, Type and SubType together uniquely identify a Relationship.
    type: string
    pattern: ^[a-zA-Z_][a-zA-Z0-9_-]*[a-zA-Z0-9_]$
    x-oapi-codegen-extra-tags:
      yaml: subType
      json: subType
  status:
    type: string
    description: Status of the relationship.
    default: enabled
    enum:
      - pending
      - approved
      - ignored
      - enabled
      - deleted
    x-oapi-codegen-extra-tags:
      yaml: status
      json: status
  evaluationQuery:
    description: "Optional. Assigns the policy to be used for the evaluation of the relationship. Deprecation Notice: In the future, this property is either to be removed or to it is to be an array of optional policy $refs."
    type: string
    pattern: ^[a-zA-Z_][a-zA-Z0-9_-]*[a-zA-Z0-9_]$
    x-oapi-codegen-extra-tags:
      yaml: evaluationQuery
      json: evaluationQuery
  capabilities:
    type: array
    description: Capabilities associated with the relationship.
    items:
      $ref: ../v1alpha1/capability/capability.yaml

    x-oapi-codegen-extra-tags:
      gorm: type:bytes;serializer:json
  metadata:
    type: object
    description: Metadata contains additional information associated with the Relationship.
    additionalProperties: true
    x-oapi-codegen-extra-tags:
      gorm: foreignKey:ModelId;references:Id
    properties:
      description:
        description: Characterization of the meaning of the relationship and its relevance to both Meshery and entities under management.
        type: string
        pattern: ^[a-zA-Z_][a-zA-Z0-9_-]*[a-zA-Z0-9_]$
        x-oapi-codegen-extra-tags:
          yaml: description
          json: description
      isAnnotation:
        type: boolean
        description: Indicates whether the relationship should be treated as a logical representation only
        x-oapi-codegen-extra-tags:
          yaml: isAnnotation
          json: isAnnotation
        default: false
      styles:
        anyOf:
          - type: object
            description: Visualization styles for a relationship
            allOf:
              - type: object
                description: Common styles for all entities
                additionalProperties: false
                required:
                  - primaryColor
                  - svgColor
                  - svgWhite
                properties:
                  primaryColor:
                    type: string
                    description: Primary color of the component used for UI representation.
                  secondaryColor:
                    type: string
                    description: Secondary color of the entity used for UI representation.
                  svgWhite:
                    type: string
                    description: White SVG of the entity used for UI representation on dark background.
                  svgColor:
                    type: string
                    description: Colored SVG of the entity used for UI representation on light background.
                  svgComplete:
                    type: string
                    description: Complete SVG of the entity used for UI representation, often inclusive of background.
                  color:
                    type: string
                    description: "The color of the element's label. Colours may be specified by name (e.g. red), hex (e.g. #ff0000 or #f00), RGB (e.g. rgb(255, 0, 0)), or HSL (e.g. hsl(0, 100%, 50%))."
                  text-opacity:
                    type: number
                    description: The opacity of the label text, including its outline.
                    minimum: 0
                    maximum: 1
                  font-family:
                    type: string
                    description: A comma-separated list of font names to use on the label text.
                  font-size:
                    type: string
                    description: The size of the label text.
                  font-style:
                    type: string
                    description: A CSS font style to be applied to the label text.
                  font-weight:
                    type: string
                    description: A CSS font weight to be applied to the label text.
                  text-transform:
                    type: string
                    description: A transformation to apply to the label text
                    enum:
                      - none
                      - uppercase
                      - lowercase
                  opacity:
                    type: number
                    description: The opacity of the element, ranging from 0 to 1. Note that the opacity of a compound node parent affects the effective opacity of its children.See https://js.cytoscape.org/#style/visibility
                    minimum: 0
                    maximum: 1
                  z-index:
                    type: integer
                    description: An integer value that affects the relative draw order of elements. In general, an element with a higher z-index will be drawn on top of an element with a lower z-index. Note that edges are under nodes despite z-index.
                  label:
                    type: string
                    description: The text to display for an element’s label. Can give a path, e.g. data(id) will label with the elements id
              - properties:
                  edge-animation:
                    type: string
                    description: The animation to use for the edge. Can be like 'marching-ants' , 'blink' , 'moving-gradient',etc .
                  curve-style:
                    type: string
                    description: The curving method used to separate two or more edges between two nodes; may be haystack (very fast, bundled straight edges for which loops and compounds are unsupported), straight (straight edges with all arrows supported), bezier (bundled curved edges), unbundled-bezier (curved edges for use with manual control points), segments (a series of straight lines), taxi (right-angled lines, hierarchically bundled). Note that haystack edges work best with ellipse, rectangle, or similar nodes. Smaller node shapes, like triangle, will not be as aesthetically pleasing. Also note that edge endpoint arrows are unsupported for haystack edges.
                    default: straight
                    enum:
                      - straight
                      - haystack
                      - bezier
                      - unbundled-bezier
                      - segments
                      - taxi
                  line-color:
                    type: string
                    description: "The colour of the edge’s line. Colours may be specified by name (e.g. red), hex (e.g. #ff0000 or #f00), RGB (e.g. rgb(255, 0, 0)), or HSL (e.g. hsl(0, 100%, 50%))."
                  line-style:
                    type: string
                    description: The style of the edge’s line.
                    enum:
                      - solid
                      - dotted
                      - dashed
                  line-cap:
                    type: string
                    description: The cap style of the edge’s line; may be butt (default), round, or square. The cap may or may not be visible, depending on the shape of the node and the relative size of the node and edge. Caps other than butt extend beyond the specified endpoint of the edge.
                    enum:
                      - butt
                      - round
                      - square
                    default: butt
                  line-opacity:
                    type: number
                    minimum: 0
                    maximum: 1
                    default: 1
                    description: The opacity of the edge’s line and arrow. Useful if you wish to have a separate opacity for the edge label versus the edge line. Note that the opacity value of the edge element affects the effective opacity of its line and label subcomponents.
                  target-arrow-color:
                    type: string
                    description: "The colour of the edge’s source arrow. Colours may be specified by name (e.g. red), hex (e.g. #ff0000 or #f00), RGB (e.g. rgb(255, 0, 0)), or HSL (e.g. hsl(0, 100%, 50%))."
                  target-arrow-shape:
                    type: string
                    description: The shape of the edge’s source arrow
                    enum:
                      - triangle
                      - triangle-tee
                      - circle-triangle
                      - triangle-cross
                      - triangle-backcurve
                      - vee
                      - tee
                      - square
                      - circle
                      - diamond
                      - chevron
                      - none
                  target-arrow-fill:
                    type: string
                    description: The fill state of the edge’s source arrow
                    enum:
                      - filled
                      - hollow
                  mid-target-arrow-color:
                    type: string
                    description: "The colour of the edge’s source arrow. Colours may be specified by name (e.g. red), hex (e.g. #ff0000 or #f00), RGB (e.g. rgb(255, 0, 0)), or HSL (e.g. hsl(0, 100%, 50%))."
                  mid-target-arrow-shape:
                    type: string
                    description: The shape of the edge’s source arrow
                    enum:
                      - triangle
                      - triangle-tee
                      - circle-triangle
                      - triangle-cross
                      - triangle-backcurve
                      - vee
                      - tee
                      - square
                      - circle
                      - diamond
                      - chevron
                      - none
                  mid-target-arrow-fill:
                    type: string
                    description: The fill state of the edge’s source arrow
                    enum:
                      - filled
                      - hollow
                  arrow-scale:
                    type: number
                    description: Scaling for the arrow size.
                    minimum: 0
                  source-label:
                    type: string
                    description: The text to display for an edge’s source label. Can give a path, e.g. data(id) will label with the elements id
                  target-label:
                    type: string
                    description: The text to display for an edge’s target label. Can give a path, e.g. data(id) will label with the elements id
          - type: object
            description: Common styles for all entities
            additionalProperties: false
            required:
              - primaryColor
              - svgColor
              - svgWhite
            properties:
              primaryColor:
                type: string
                description: Primary color of the component used for UI representation.
              secondaryColor:
                type: string
                description: Secondary color of the entity used for UI representation.
              svgWhite:
                type: string
                description: White SVG of the entity used for UI representation on dark background.
              svgColor:
                type: string
                description: Colored SVG of the entity used for UI representation on light background.
              svgComplete:
                type: string
                description: Complete SVG of the entity used for UI representation, often inclusive of background.
              color:
                type: string
                description: "The color of the element's label. Colours may be specified by name (e.g. red), hex (e.g. #ff0000 or #f00), RGB (e.g. rgb(255, 0, 0)), or HSL (e.g. hsl(0, 100%, 50%))."
              text-opacity:
                type: number
                description: The opacity of the label text, including its outline.
                minimum: 0
                maximum: 1
              font-family:
                type: string
                description: A comma-separated list of font names to use on the label text.
              font-size:
                type: string
                description: The size of the label text.
              font-style:
                type: string
                description: A CSS font style to be applied to the label text.
              font-weight:
                type: string
                description: A CSS font weight to be applied to the label text.
              text-transform:
                type: string
                description: A transformation to apply to the label text
                enum:
                  - none
                  - uppercase
                  - lowercase
              opacity:
                type: number
                description: The opacity of the element, ranging from 0 to 1. Note that the opacity of a compound node parent affects the effective opacity of its children.See https://js.cytoscape.org/#style/visibility
                minimum: 0
                maximum: 1
              z-index:
                type: integer
                description: An integer value that affects the relative draw order of elements. In general, an element with a higher z-index will be drawn on top of an element with a lower z-index. Note that edges are under nodes despite z-index.
              label:
                type: string
                description: The text to display for an element’s label. Can give a path, e.g. data(id) will label with the elements id
            $comment: Extension point for additional styles
        x-oapi-codegen-extra-tags:
          yaml: styles
          json: styles
  selectors:
    x-oapi-codegen-extra-tags:
      gorm: type:bytes;serializer:json
    type: array
    description: Selectors are organized as an array, with each item containing a distinct set of selectors that share a common functionality. This structure allows for flexibility in defining relationships, even when different components are involved.
    $comment: Sets of selectors are interpreted as a logical UNION. Properties within a selector `allow` and `deny` are interpreted as logical AND, while 'from' and 'to' represents a UNION of set of combinatorial pairs.
    items:
      $ref: "#/definitions/SelectorPair"
  created_at:
    $ref: ../v1alpha1/core/api.yml#/components/schemas/created_at
  updated_at:
    $ref: ../v1alpha1/core/api.yml#/components/schemas/updated_at

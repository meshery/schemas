// This is not autogenerated.
package organization

import (
	"database/sql/driver"
	"encoding/json"

	"github.com/gobuffalo/pop/slices"
	"github.com/meshery/meshkit/utils"
)

// Scan implements sql.Scanner interface for OrgMetadata
func (om *OrgMetadata) Scan(value interface{}) error {
	if value == nil {
		*om = OrgMetadata{
			Preferences: Preferences{
				Theme: Theme{
					Vars: make(map[string]interface{}),
				},
				Dashboard: DashboardPrefs{
					Layout: make(slices.Map),
				},
			},
		}
		return nil
	}

	data, err := utils.Cast[[]byte](value)
	if err != nil {
		return err
	}

	// Pre-initialize all maps before unmarshaling
	*om = OrgMetadata{
		Preferences: Preferences{
			Theme: Theme{
				Vars: make(map[string]interface{}),
			},
			Dashboard: DashboardPrefs{
				Layout: make(slices.Map),
			},
		},
	}

	if err := json.Unmarshal(data, om); err != nil {
		return utils.ErrUnmarshal(err)
	}

	return nil
}

// Value implements driver.Valuer interface for OrgMetadata
func (om OrgMetadata) Value() (driver.Value, error) {
	marshaledValue, err := json.Marshal(om)
	if err != nil {
		return nil, utils.ErrMarshal(err)
	}
	return marshaledValue, nil
}

// EventCategory returns the event category for Organization
func (*Organization) EventCategory() string {
	return "organization"
}
